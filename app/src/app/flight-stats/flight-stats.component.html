@if (stats(); as statsVal) {
<div class="stats-glass-card glass-card">
  <div class="stats-header">
    <mat-icon>analytics</mat-icon>
    <span class="header-title">Statistics</span>
  </div>

  <mat-divider></mat-divider>

  <div class="stats-content">
    <!-- Data Accuracy Section -->
    <section class="stats-section">
      <h3 class="section-label">Data Accuracy</h3>
      <div class="status-grid">
        <div class="status-item">
          <span class="status-label">Lufthansa API</span>
          <mat-icon [class.success]="!!flight().lhApiFlight" [class.error]="!flight().lhApiFlight">
            {{ !!flight().lhApiFlight ? 'check_circle' : 'cancel' }}
          </mat-icon>
        </div>
        <div class="status-item">
          <span class="status-label">Aero API</span>
          <mat-icon [class.success]="!!flight().aeroApiFlight" [class.error]="!flight().aeroApiFlight">
            {{ !!flight().aeroApiFlight ? 'check_circle' : 'cancel' }}
          </mat-icon>
        </div>
        <div class="status-item">
          <span class="status-label">Aero API Track</span>
          @if (track(); as trackVal) {
          <mat-icon [class.success]="trackVal.actual_distance > 0" [class.warning]="trackVal.actual_distance <= 0">
            {{ trackVal.actual_distance > 0 ? 'check_circle' : 'star_half' }}
          </mat-icon>
          } @else {
          <mat-icon class="error">cancel</mat-icon>
          }
        </div>
      </div>
    </section>

    <mat-divider></mat-divider>

    <!-- Flight Counts Section -->
    <section class="stats-section">
      <h3 class="section-label">Frequency</h3>
      <div class="count-grid">
        <div class="count-item">
          <span class="count-value">{{ statsVal.flightsOnRoute }}</span>
          <span class="count-label">same route</span>
        </div>
        <div class="count-item">
          <span class="count-value">{{ statsVal.flightsWithAircraft.length }}</span>
          <span class="count-label">same A/C</span>
        </div>
        <div class="count-item">
          <span class="count-value">{{ statsVal.flightsWithType }}</span>
          <span class="count-label">same Type</span>
        </div>
      </div>
    </section>

    @if (statsVal.flightsWithAircraft.length > 1) {
    <mat-divider></mat-divider>

    <!-- Same Aircraft Flights Section -->
    <section class="stats-section">
      <mat-accordion>
        <mat-expansion-panel class="aircraft-panel">
          <mat-expansion-panel-header>
            <mat-panel-title>
              See all flights with this aircraft
            </mat-panel-title>
          </mat-expansion-panel-header>

          <div class="aircraft-flights-grid">
            @for (f of statsVal.flightsWithAircraft; track f._id) {
            <div class="preview-tile">
              <app-flight-tile [flight]="f" [compact]="true"></app-flight-tile>
            </div>
            }
          </div>
        </mat-expansion-panel>
      </mat-accordion>
    </section>
    }
  </div>
</div>
}