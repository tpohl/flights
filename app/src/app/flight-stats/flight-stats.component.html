<div class="stats-glass-card glass-card" *ngIf="(stats$ | async) as stats">
  <div class="stats-header">
    <mat-icon>analytics</mat-icon>
    <span class="header-title">Statistics</span>
  </div>

  <mat-divider></mat-divider>

  <div class="stats-content">
    <!-- Data Accuracy Section -->
    <section class="stats-section">
      <h3 class="section-label">Data Accuracy</h3>
      <div class="status-grid">
        <div class="status-item">
          <span class="status-label">Lufthansa API</span>
          <mat-icon [class.success]="!!flight.lhApiFlight" [class.error]="!flight.lhApiFlight">
            {{ !!flight.lhApiFlight ? 'check_circle' : 'cancel' }}
          </mat-icon>
        </div>
        <div class="status-item">
          <span class="status-label">Aero API</span>
          <mat-icon [class.success]="!!flight.aeroApiFlight" [class.error]="!flight.aeroApiFlight">
            {{ !!flight.aeroApiFlight ? 'check_circle' : 'cancel' }}
          </mat-icon>
        </div>
        <div class="status-item">
          <span class="status-label">Aero API Track</span>
          <ng-container *ngIf="(aeroApiTrack$|async) as aeroApiTrack; else noAeroApiTrack">
            <mat-icon [class.success]="!!aeroApiTrack && aeroApiTrack?.actual_distance > 0"
              [class.warning]="!!aeroApiTrack && aeroApiTrack?.actual_distance <= 0" [class.error]="!aeroApiTrack">
              {{ !!aeroApiTrack ? (aeroApiTrack?.actual_distance > 0 ? 'check_circle' : 'star_half') : 'cancel' }}
            </mat-icon>
          </ng-container>
          <ng-template #noAeroApiTrack>
            <mat-icon class="error">cancel</mat-icon>
          </ng-template>
        </div>
      </div>
    </section>

    <mat-divider></mat-divider>

    <!-- Flight Counts Section -->
    <section class="stats-section">
      <h3 class="section-label">Frequency</h3>
      <div class="count-grid">
        <div class="count-item">
          <span class="count-value">{{ stats.flightsOnRoute }}</span>
          <span class="count-label">same route</span>
        </div>
        <div class="count-item">
          <span class="count-value">{{ stats.flightsWithAircraft.length }}</span>
          <span class="count-label">same A/C</span>
        </div>
        <div class="count-item">
          <span class="count-value">{{ stats.flightsWithType }}</span>
          <span class="count-label">same Type</span>
        </div>
      </div>
    </section>

    <!-- Same Aircraft Flights Section -->
    <section class="stats-section" *ngIf="stats.flightsWithAircraft.length > 1">
      <mat-accordion>
        <mat-expansion-panel class="aircraft-panel">
          <mat-expansion-panel-header>
            <mat-panel-title>
              See all flights with this aircraft
            </mat-panel-title>
          </mat-expansion-panel-header>

          <div class="aircraft-flights-grid">
            @for (f of stats.flightsWithAircraft; track $index) {
            <div class="preview-tile">
              <app-flight-tile [flight]="f" [compact]="true"></app-flight-tile>
            </div>
            }
          </div>
        </mat-expansion-panel>
      </mat-accordion>
    </section>
  </div>
</div>