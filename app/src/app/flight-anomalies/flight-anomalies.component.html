<div class="flight-anomalies-container">
  <header class="page-header">
    <h1 class="page-title">Flight Anomalies</h1>
    <span class="subtitle">Flights with unusual speeds that may contain data errors</span>
  </header>

  <div class="main-content">
    <!-- Info Card -->
    <mat-card class="info-card glass-card">
      <mat-card-content>
        <mat-icon class="info-icon">info</mat-icon>
        <div class="info-text">
          <strong>{{ totalAnomalies }}</strong> flight(s) detected with unusual speeds
        </div>
        <div class="info-description">
          These flights are either exceptionally slow or fast, indicating potential data entry errors.
          Click any flight below to edit and correct the data.
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Filters -->
    <section class="filters-container glass-card">
      <div class="filter-group">
        <mat-checkbox [(ngModel)]="showTooSlow" color="warn">
          Too Slow ({{ tooSlowFlights().length }})
        </mat-checkbox>
        <mat-checkbox [(ngModel)]="showTooFast" color="warn">
          Too Fast ({{ tooFastFlights().length }})
        </mat-checkbox>
        <mat-checkbox [(ngModel)]="showValidated" color="primary">
          Validated ({{ totalValidated }})
        </mat-checkbox>
      </div>
    </section>

    <!-- Content -->
    @if (displayedFlights().length === 0) {
    <div class="empty-state">
      <mat-icon>thumb_up</mat-icon>
      <p>No flights match your selection!</p>
    </div>
    } @else {
    <section class="flights-grid">
      @for (flight of displayedFlights(); track flight._id) {
      <app-flight-card [flight]="flight" [validated]="getAnomalyType(flight) === 'validated'">
        <div class="anomaly-content">
          <!-- Badge logic -->
          @if (getAnomalyType(flight) === 'validated') {
          <div class="anomaly-badge validated">
            <mat-icon>verified</mat-icon>
            <span>Validated</span>
          </div>
          } @else if (getAnomalyType(flight) === 'slow') {
          <div class="anomaly-badge slow">
            <mat-icon>warning</mat-icon>
            <span>Very Slow</span>
          </div>
          } @else {
          <div class="anomaly-badge fast">
            <mat-icon>warning</mat-icon>
            <span>Very Fast</span>
          </div>
          }

          <app-flight-tile [flight]="flight"></app-flight-tile>

          <div class="speed-info">
            <span class="label">Average Speed:</span>
            <span class="value">{{ calculateAverageSpeed(flight) | number: '1.0-0' }} km/h</span>

            @if (getAnomalyType(flight) === 'validated') {
            <span class="type-badge" [class.slow]="isSlowAnomaly(flight)" [class.fast]="!isSlowAnomaly(flight)">
              @if (isSlowAnomaly(flight)) { Slow } @else { Fast }
            </span>
            }
          </div>
        </div>
      </app-flight-card>
      }
    </section>
    }

    <!-- Back to Flights button -->
    <div class="action-buttons">
      <button mat-raised-button color="primary" [routerLink]="['/flights']">
        <mat-icon>arrow_back</mat-icon>
        Back to Flights
      </button>
    </div>
  </div>
</div>